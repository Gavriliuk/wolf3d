<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<meta name="description" content="Wolfenstein 3D HTML5">
<meta name="keywords" content="wolfenstein,3d,game,html5,javascript,engine"> 
<title>Wolfenstein 3D</title>
<link rel="stylesheet" href="css/build.css" type="text/css" />
<script src="js/webkitAudioContextMonkeyPatch.js" type="text/javascript" language="javascript"></script>
<link rel="shortcut icon" type="image/png" href="images/favicon.png"/>
<link rel="icon" type="image/png" href="images/favicon.png"/>
<script type="text/javascript">
const ga=x=>0

const start=e=>{
 document.body.innerHTML=''

 const script=document.createElement('script')
 script.addEventListener('load',()=>{
  setTimeout(()=>{
   dispatchEvent(new Event('load'))
  },1000)
 })
 script.src='js/build_readable.js'
 document.head.appendChild(script)

 let prevX=0
//debug=1
 addEventListener('mousemove',e=>{
  if(!game||!game.client||!game.client.speed||game.activeScreen!='game')return
  const c=document.getElementById('container')
  if(!c)return
  const x=e.clientX
  const dx=x-prevX
  if(!dx)return
  prevX=x
  if(c.offsetTop>e.clientY||e.clientY>c.offsetTop+c.offsetHeight)return
  if(e.altKey){
   //const saved=game.client.speed.move
   //game.client.speed.move/=10
   game.client[dx>0?'strafeRight':'strafeLeft']()
   //game.client.speed.move=saved
  }else{
//if(debug)console.log(JSON.stringify(game.levelConfig)),debug=0
   const saved=game.client.speed.rotation
   game.client.speed.rotation*=dx/10
   game.client.right()
   game.client.speed.rotation=saved
  }
 },{capture:true})

 let fireInterval=null

 addEventListener('mousedown',e=>{
  if(!game||!game.client)return
  if(e.button)return game.client.door()
  if(!game.client.activeWeapon)return
  if(2>game.client.activeWeapon.id)return game.client.activeWeapon.animation.play()
  if(!fireInterval)fireInterval=setInterval(e=>{
   if(game.client.activeWeapon.ammo)game.client.activeWeapon.fire(game.client)
   else clearInterval(fireInterval),fireInterval=null,game.client.activeWeapon.animation.play()
  },20)
 },{capture:true})

 addEventListener('mouseup',e=>{
  if(e.button||!fireInterval)return
  clearInterval(fireInterval)
  fireInterval=null
  game.client.activeWeapon.animation.play()
 },{capture:true})

 addEventListener('keypress',e=>{
  if(!game||!game.client||!game.client.activeWeapon)return
  if(e.code=='KeyW')game.client.forward()
  else if(e.code=='KeyS')game.client.backward()
  else if(e.code=='KeyQ')game.client.strafeLeft()
  else if(e.code=='KeyE')game.client.strafeRight()
  else if(e.code=='KeyA')game.client[e.altKey?'strafeLeft':'left']()
  else if(e.code=='KeyD')game.client[e.altKey?'strafeRight':'right']()
  else if(e.code=='Numpad1'){
   wolf3d.silverKey().listeners.hit(game.client)
  }else if(e.code=='Numpad2'){
   wolf3d.goldKey().listeners.hit(game.client)
  }else if(e.code=='Numpad3'){
   wolf3d.machineGun().listeners.hit(game.client)
  }else if(e.code=='Numpad4'){
   wolf3d.gatling().listeners.hit(game.client)
  }else if(e.code=='Numpad5'){
   game.client.setProperty("ammo",game.client.max.ammo)
  }else if(e.code=='Numpad6'){
   game.client.setProperty("health",game.client.max.health)
  }else if(e.code=='Digit5'){
   game.client.max.ammo=e.shiftKey?1000000:99
   game.client.setProperty("ammo",game.client.max.ammo)
  }else if(e.code=='Digit6'){
   game.client.max.health=e.shiftKey?1000000:100
   game.client.setProperty("health",game.client.max.health)
  }else if(e.code=='Digit8'){
   if(e.shiftKey)game.client.leveldone=1
  }else if(e.code=='Digit9'){
   if(e.shiftKey){
    game.client.ratio.kill=game.client.map.ai.length
    game.client.ratio.secret=game.client.map.secrets.length
    game.client.ratio.treasure=game.client.map.treasures
    game.client.leveldone=1
   }
  }else if(e.code=='Digit0'){
   if(e.shiftKey)game.client.map.ai.forEach(ai=>{if(ai.hit){ai.animations.current='dying'}})
  }
 },{capture:true})

}


</script>
</head>
<body oncontextmenu="return false;">
<button style="display:block;margin:40vh auto;font-size:2em" onclick="start()">Start</button>
</body>
</html>
